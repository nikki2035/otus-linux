# PAM

## Запретить всем пользователям, кроме группы admin логин в выходные и праздничные дни

Cоздадим пользователей:

```
useradd day
useradd friday
```

Назначим им пароли:

```
echo "Otus2019" | sudo passwd --stdin day
echo "Otus2019" | sudo passwd --stdin friday
```

# PAM. Модуль pam_time
Модуль **pam_time** позволяет достаточно гибко настроить доступ пользователя с учетом времени. Настройки данного модуля хранятся в файле ``/etc/security/time.conf``. Данный файл содержит в себе пояснения и примеры использования. Добавим в конец файла строки:

```
* ; * ; day|friday ; Wk0000-2400
```

Разные параметры отделяются символом ";". Разберем первую строку:
- “*” сервис, к которому применяется правило
- "*" имя терминала, к которому применяется правило
- имя пользователя, для которого данное правило будет действовать
- время, когда правило носит разрешающий характер

Теперь настроим PAM, так как по-умолчанию данный модуль не подключен.
Для этого приведем файл ``/etc/pam.d/sshd`` к виду:

```
...
account required pam_nologin.so
account required pam_time.so
...
```

## Дать конкретному пользователю права рута

Попробуем выполнить команду nc от пользователя ``day`` и получим сообщение об ошибке.

```
sudo -u day ncat -l -p 80
Ncat: bind to :::80: Permission denied. QUITTING.
```

Это связано с тем, что непривелигерованный пользователь day, от имени которого выполняется команда, не может открыть для прослушивания 80й порт.

Приведем файл ``/etc/pam.d/sshd`` к виду:

```
...
auth include postlogin
auth required pam_cap.so
...
```

Таким образом мы включили обработку capabilities при подключении по ssh. Пропишем необходимые права пользователю day. Для этого создадим файл ``/etc/security/capability.conf`` содержащий одну строку:

```
cap_sys_admin,cap_net_bind_service day

```

Зайдем на стенд под пользователем ``day`` и проверим, что мы получили необходимые права:

```
capsh --print
Current: = cap_net_bind_service,cap_sys_admin+i
```

Теперь попробуем выполнить команду:

```
ncat -l -p 80
```

Теперь ошибки не возникло. Теперь можно открыть еще одну консоль и там выполнить:

```
echo 'Make Linux great again!' > /dev/tcp/127.0.0.7/80
```

и увидеть сообщение в перовой консоли.
