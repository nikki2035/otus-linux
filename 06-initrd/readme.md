# Попасть в систему без пароля несколькими способами

Для получения доступа необходимо открыть GUI VirtualBox (или другой системы
виртуализации), запустить виртуальную машину и при выборе ядра для загрузки нажать e - в
данном контексте edit. Попадаем в окно где мы можем изменить параметры загрузки:
Попасть в систему без пароля несколькими способами

В строке начинаящейся с ``linux16`` заменяем ``ro`` на ``rw`` - чтобы файловая система монтировалась в режимо RW, а не RO.
Или уже загрузившись перемонтировать командой

```
mount -o remount,rw /
```

## Способ 1. Интерактивный режим загрузчика init=/bin/sh

В конце строки начинаящейся с ``linux16`` добавляем

```
init=/bin/sh
```

и нажимаем ``сtrl-x`` для загрузки в систему.

## Способ 2. Остановка процесса запуска до монтирования системы rd.break

В конце строки начинаящейся с ``linux16`` добавляем

```
rd.break
```

и нажимаем ``сtrl-x`` для загрузки в систему.

Попадаем в emergency mode. Наша корневая файловая система смонтирована, но мы не в ней. Далее будет пример как попасть в нее и поменять пароль администратора:

```
chroot /sysroot
passwd root
touch /.autorelabel
```

После чего можно перезагружаться и заходить в систему с новым паролем. Полезно когда вы потеряли или вообще не имели пароль администратор.

## Способ 3. Вход в аварийный режим rw init=/sysroot/bin/sh

В строке начинаящейся с ``linux16`` добавляем

```
init=/sysroot/bin/sh
```

и нажимаем ``сtrl-x`` для загрузки в систему.

# Установить систему с LVM, после чего переименовать VG

Посмотрим текущее состояние системы:

```
vgs
VG #PV #LV #SN Attr VSize VFree
centos 1 2 0 wz--n- 7,51g 40,00m
```

Нас интересует вторая строка с именем Volume Group
Приступим к переименования:

```
vgrename centos OtusRoot
Volume group "centos" successfully renamed to "OtusRoot"
```

Далее правим ``/etc/fstab``, ``/etc/default/grub``, ``/boot/grub2/grub.cfg``. Везде заменяем старое название на новое.

Пересоздаем initrd image, чтобы он знал новое название Volume Group

```
mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
...
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-862.2.3.el7.x86_64.img' done ***
```

После чего можем перезагружаться и если все сделано правильно успешно грузимся с новым именем Volume Group и проверяем:

```
vgs
VG #PV #LV #SN Attr VSize VFree
OtusRoot 1 2 0 wz--n- <38.97g 0
```

При желании можно так же заменить название Logical Volume.

# Добавить модуль в initrd

Скрипты модулей хранятся в каталоге ``/usr/lib/dracut/modules.d/``. Для того чтобы
добавить свой модуль создаем там папку с именем 01test:

```
mkdir /usr/lib/dracut/modules.d/01test
```

В нее поместим два скрипта:
1. module-setup.sh - который устанавливает модуль и вызывает скрипт test.sh

```
#!/bin/bash

check() {
    return 0
}

depends() {
    return 0
}

install() {
    inst_hook cleanup 00 "${moddir}/test.sh"
}
```

2. test.sh - собственно сам вызываемый скрипт, в нём у нас рисуется пингвинчик

```
#!/bin/bash

exec 0<>/dev/console 1<>/dev/console 2<>/dev/console
cat <<'msgend'
Hello! You are in dracut module!
 ___________________
< I'm dracut module >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/
msgend
sleep 10
echo " continuing...."
```

Пересобираем образ initrd

```
mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
```

или

```
dracut -f -v
```

Можно проверить/посмотреть какие модули загружены в образ:

```
lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
```

После чего можно пойти двумя путями для проверки:\
Перезагрузиться и руками выключить опции rghb и quiet и увидеть вывод\
Либо отредактировать grub.cfg убрав эти опции\
В итоге при загрузке будет пауза на 10 секунд и вы увидите пингвина в выводе терминала